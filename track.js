!function(){window.dataLayer=window.dataLayer||[];var e=window.tjHub||{};e.queue=e.queue||[];const t="https://tj-track-bd.tj-studio-ltda.workers.dev/get-tracking-data";function n(){return"undefined"!=typeof gtag}function i(e,t){if(n())try{gtag("event",e,{...t,send_to:"all",non_interaction:"scroll"===e||"vertical_scroll"===e})}catch(e){console.warn("GA4 tracking error:",e)}}function o(){const e=window.innerWidth;return e<=768?"mobile":e<=1024?"tablet":"desktop"}e.site_id=function(){const e=document.getElementsByTagName("script");for(let t of e)if(t.src.includes("site_id="))try{return new URL(t.src).searchParams.get("site_id")}catch(e){}return"TJTJS2025"}(),e.session_id=localStorage.getItem("tj_session_id")||`sess_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("tj_session_id",e.session_id);const a={get:e=>{const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null},getGaId:function(){const e=this.get("_ga");return e?e.replace(/^GA1\.\d\./,""):null},getGaSession:function(){const e=document.cookie.split(";");for(let t of e)if(t.trim().startsWith("_ga_")&&t.split(".").length>2)return t.split(".")[2];return null}};function c(){return{utm_source:localStorage.getItem("tj_utm_source"),utm_medium:localStorage.getItem("tj_utm_medium"),utm_campaign:localStorage.getItem("tj_utm_campaign"),utm_content:localStorage.getItem("tj_utm_content"),utm_term:localStorage.getItem("tj_utm_term"),gclid:localStorage.getItem("tj_gclid"),fbclid:localStorage.getItem("tj_fbclid"),ga_client_id:a.getGaId(),ga_session_id:a.getGaSession(),fbp:a.get("_fbp"),fbc:a.get("_fbc")}}e.queue=e.queue||[],function(){const e=new URLSearchParams(window.location.search);["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","fbclid"].forEach(t=>{e.has(t)&&localStorage.setItem("tj_"+t,e.get(t))})}();let l,r=0,s=0;window.addEventListener("scroll",function(){r=window.scrollY;const t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-window.innerHeight,n=t>0?Math.round(r/t*100):0;n>s&&(s=n),clearTimeout(l),l=setTimeout(()=>{const t={scroll_y:r,scroll_depth:n,max_scroll_depth:s,screen_size:`${window.innerWidth}x${window.innerHeight}`,session_id:e.session_id,page_path:window.location.pathname,device_category:o()};e.track("vertical_scroll",t),i("scroll",{scroll_depth:n,page_path:window.location.pathname,device_category:o()})},3e3)}),e.track=function(n,i={}){i.url=window.location.href,i.referrer=document.referrer,i.session_id=e.session_id,i.site_id=e.site_id,i.screen_size=`${window.innerWidth}x${window.innerHeight}`,i.device=navigator.userAgent,i.device_category=o(),i.timestamp=(new Date).toISOString(),e.queue.push({event:n,data:i}),e.sending||(e.sending=setTimeout(()=>{let n=e.queue.slice();e.queue=[];const i=JSON.stringify({events:n});navigator.sendBeacon?navigator.sendBeacon(`${t}?site_id=${e.site_id}`,i):fetch(`${t}?site_id=${e.site_id}`,{method:"POST",body:i}),e.sending=null},5e3))},e.track("page_view"),i("page_view",{page_path:window.location.pathname,page_title:document.title,device_category:o()}),document.addEventListener("click",function(n){const a=n.pageX,c=n.pageY,l=window.innerWidth,r=window.innerHeight,s=Math.round(n.clientX/l*100),d=Math.round(n.clientY/r*100),_=n.target.closest("a, button");if(!_){const t={click_x:a,click_y:c,click_x_percent:s,click_y_percent:d,page_path:window.location.pathname,target:n.target.tagName.toLowerCase(),class:n.target.className||"",id:n.target.id||"",device_category:o()};return e.track("heatmap_click",t),void i("heatmap_click",{click_x:a,click_y:c,page_path:window.location.pathname,element_id:n.target.id||"(not set)",element_class:n.target.className||"(not set)",device_category:o()})}let m={target:_.tagName.toLowerCase(),text:_.innerText?_.innerText.substring(0,50):"",class:_.className||"",id:_.id||"",href:_.href||"",click_x:a,click_y:c,click_x_percent:s,click_y_percent:d,page_path:window.location.pathname,device_category:o()};"a"===_.tagName.toLowerCase()&&_.hostname!==window.location.hostname?(m.external=!0,e.track("click_outbound",m),navigator.sendBeacon(`${t}?site_id=${e.site_id}`,JSON.stringify({events:[{event:"click_outbound",data:m}]})),i("click_outbound",{click_x:a,click_y:c,link_url:_.href,link_text:m.text,page_path:window.location.pathname,device_category:o()})):(e.track("click",m),i("click",{click_x:a,click_y:c,element_id:m.id||"(not set)",element_text:m.text,page_path:window.location.pathname,device_category:o()}))}),document.addEventListener("submit",function(t){const n=t.target;if(!n||"form"!==n.tagName.toLowerCase())return;if("true"!==n.getAttribute("data-track"))return;let a=new FormData(n),l={},r={nome:null,email:null,tel:null};for(let[e,t]of a.entries())if("string"!=typeof e||!e.toLowerCase().includes("senha")){l[e]=t;let n=e.toLowerCase();r.nome||!n.includes("nome")&&!n.includes("name")?!r.email&&n.includes("mail")?r.email=t:!r.tel&&(n.includes("tel")||n.includes("cel")||n.includes("whats"))&&(r.tel=t):r.nome=t}const s={tag:n.getAttribute("data-tag")||"Form Site",action:n.action||"",method:n.method||"GET",form_id:n.id||"",form_class:n.className||"",fields:l,lead_info:r,marketing:c(),page_path:window.location.pathname,device_category:o()};e.track("form_submit",s),i("form_submit",{form_id:s.form_id||"(not set)",form_destination:s.action,page_path:window.location.pathname,device_category:o()})});let d=!1;window.addEventListener("scroll",function(){if(d)return;const t=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)-window.innerHeight,n=window.scrollY;(t>0?n/t*100:0)>=90&&(d=!0,e.track("scroll_completion",{scroll_depth:90,page_path:window.location.pathname,device_category:o()}),i("scroll_completion",{scroll_depth:90,page_path:window.location.pathname,device_category:o()}))}),window.tjHub=e,console.log("âœ… TJ Track Enhanced with GA4 Heatmap initialized",{site_id:e.site_id,session_id:e.session_id,ga4_available:n()})}();