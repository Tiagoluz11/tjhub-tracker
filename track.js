/*! TJHub Tracker v1.2.0 | (c) 2025 TJ-Studio LTDA | tj-studio-ltda.com */
!function(){window.dataLayer=window.dataLayer||[];var e=window.tjHub||{};e.queue=e.queue||[];const t="https://tj-track-bd.tj-studio-ltda.workers.dev/get-tracking-data";let n=0,o=!1;function i(){return typeof gtag!="undefined"}function a(e,t){i()&&gtag("event",e,{...t,send_to:"all",non_interaction:e==="scroll"||e==="vertical_scroll"})}function c(){const e=window.innerWidth;return e<=768?"mobile":e<=1024?"tablet":"desktop"}e.site_id=function(){const e=document.getElementsByTagName("script");for(let t of e)if(t.src.includes("site_id="))try{return new URL(t.src).searchParams.get("site_id")}catch(e){}return"TJTJS2025"}(),e.session_id=localStorage.getItem("tj_session_id")||`sess_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("tj_session_id",e.session_id);const d={get:e=>{const t=`; ${document.cookie}`.split(`; ${e}=`);return t.length===2?t.pop().split(";").shift():null},getGaId:function(){const e=this.get("_ga");return e?e.replace(/^GA1\.\d\./,""):null},getGaSession:function(){const e=document.cookie.split(";");for(let t of e)if(t.trim().startsWith("_ga_")&&t.split(".").length>2)return t.split(".")[2];return null}};function l(){return{utm_source:localStorage.getItem("tj_utm_source"),utm_medium:localStorage.getItem("tj_utm_medium"),utm_campaign:localStorage.getItem("tj_utm_campaign"),utm_content:localStorage.getItem("tj_utm_content"),utm_term:localStorage.getItem("tj_utm_term"),gclid:localStorage.getItem("tj_gclid"),fbclid:localStorage.getItem("tj_fbclid"),ga_client_id:d.getGaId(),ga_session_id:d.getGaSession(),fbp:d.get("_fbp"),fbc:d.get("_fbc")}}(function(){const e=new URLSearchParams(window.location.search);["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","fbclid"].forEach(t=>{e.has(t)&&localStorage.setItem("tj_"+t,e.get(t))})})(),window.addEventListener("scroll",function(){const e=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-window.innerHeight,t=e>0?Math.round(window.scrollY/e*100):0;t>n&&(n=t)},{passive:!0});function r(){if(!o){if(n>0){const t={max_scroll_depth:n,page_path:window.location.pathname,device_category:c()};e.track("scroll_depth_max",t),a("scroll_depth",{max_scroll_depth:n,page_path:window.location.pathname,device_category:c()})}o=!0}}document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&r()}),window.addEventListener("pagehide",r);function s(){if(e.sending&&(clearTimeout(e.sending),e.sending=null),e.queue.length>0){let n=e.queue.slice();e.queue=[];const o=JSON.stringify({events:n}),i=`${t}?site_id=${e.site_id}`;navigator.sendBeacon?navigator.sendBeacon(i,o):fetch(i,{method:"POST",body:o,keepalive:!1})}}window.addEventListener("pagehide",s),e.track=function(t,n={}){n.url=window.location.href,n.referrer=document.referrer,n.session_id=e.session_id,n.site_id=e.site_id,n.screen_size=`${window.innerWidth}x${window.innerHeight}`,n.device=navigator.userAgent,n.device_category=c(),n.timestamp=(new Date).toISOString(),e.queue.push({event:t,data:n}),e.sending||(e.sending=setTimeout(s,5e3))},e.track("page_view"),a("page_view",{page_path:window.location.pathname,page_title:document.title,device_category:c()}),document.addEventListener("click",function(t){const n=t.pageX,o=t.pageY,d=window.innerWidth,l=window.innerHeight,m=Math.round(t.clientX/d*100),g=Math.round(t.clientY/l*100),u=t.target.closest("a, button");if(!u){const n={click_x:t.pageX,click_y:t.pageY,click_x_percent:m,click_y_percent:g,page_path:window.location.pathname,target:t.target.tagName.toLowerCase(),class:t.target.className||"",id:t.target.id||"",device_category:c()};return e.track("heatmap_click",n),void a("heatmap_click",{click_x:t.pageX,click_y:t.pageY,page_path:window.location.pathname,element_id:t.target.id||"(not set)",element_class:t.target.className||"(not set)",device_category:c()})}let p={target:u.tagName.toLowerCase(),text:u.innerText?u.innerText.substring(0,50):"",class:u.className||"",id:u.id||"",href:u.href||"",click_x:n,click_y:o,click_x_percent:m,click_y_percent:g,page_path:window.location.pathname,device_category:c()};if(u.tagName.toLowerCase()==="a"&&u.hostname!==window.location.hostname){p.external=!0,e.track("click_outbound",p);const i=`${t}?site_id=${e.site_id}`,d=JSON.stringify({events:[{event:"click_outbound",data:p}]});navigator.sendBeacon(i,d),a("click_outbound",{click_x:n,click_y:o,link_url:u.href,link_text:p.text,page_path:window.location.pathname,device_category:c()})}else e.track("click",p),a("click",{click_x:n,click_y:o,element_id:p.id||"(not set)",element_text:p.text,page_path:window.location.pathname,device_category:c()})}),document.addEventListener("submit",function(t){const n=t.target;if(!n||n.tagName.toLowerCase()!=="form")return;if(n.getAttribute("data-track")!=="true")return;let o=new FormData(n),d={},r={nome:null,email:null,tel:null};for(let[e,t]of o.entries())if(typeof e=="string"&&!e.toLowerCase().includes("senha")){d[e]=t;let n=e.toLowerCase();r.nome||!n.includes("nome")&&!n.includes("name")?!r.email&&n.includes("mail")?r.email=t:!r.tel&&(n.includes("tel")||n.includes("cel")||n.includes("whats"))&&(r.tel=t):r.nome=t}const s={tag:n.getAttribute("data-tag")||"Form Site",action:n.action||"",method:n.method||"GET",form_id:n.id||"",form_class:n.className||"",fields:d,lead_info:r,marketing:l(),page_path:window.location.pathname,device_category:c()};e.track("form_submit",s),a("form_submit",{form_id:s.form_id||"(not set)",form_destination:s.action,page_path:window.location.pathname,device_category:c()})}),window.tjHub=e,console.log("âœ… TJ Track Enhanced with GA4 Heatmap initialized",{site_id:e.site_id,session_id:e.session_id,ga4_available:i()})}();