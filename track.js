!function(){var t=window.tjHub||{};t.dataLayer=window.dataLayer=window.dataLayer||[];const n={webhookUrl:"https://dev-tjhub.tjstudio.com.br/api/webhook-central.php",workerUrl:"https://tj-track-bd.tj-studio-ltda.workers.dev/get-tracking-data"};function e(){const t=document.getElementsByTagName("script");for(let n of t)if(n.src.includes("tjhub")||n.src.includes("track.js"))try{return new URL(n.src).searchParams.get("site_id")}catch(t){}return"TJTJS2025"}t.site_id=e()||"TJTJS2025",t.session_id=localStorage.getItem("tj_session_id")||`sess_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("tj_session_id",t.session_id);const o={get:function(t){const n=`; ${document.cookie}`.split(`; ${t}=`);if(2===n.length)return n.pop().split(";").shift();return null},getGAClientId:function(){const t=this.get("_ga");return t?t.replace(/^GA1\.\d\./,""):null},getGASessionId:function(){const t=document.cookie.split(";");for(let n=0;n<t.length;n++){const e=t[n].trim();if(e.startsWith("_ga_")){const t=e.split(".");if(t.length>2)return t[2]}}return null}};function a(){const t=new URLSearchParams(window.location.search),n=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","fbclid"];let e=!1;n.forEach(n=>{t.has(n)&&(localStorage.setItem("tj_"+n,t.get(n)),e=!0)}),e&&localStorage.setItem("tj_campaign_time",(new Date).toISOString())}function r(){const t={utm_source:localStorage.getItem("tj_utm_source")||null,utm_medium:localStorage.getItem("tj_utm_medium")||null,utm_campaign:localStorage.getItem("tj_utm_campaign")||null,utm_content:localStorage.getItem("tj_utm_content")||null,utm_term:localStorage.getItem("tj_utm_term")||null,gclid:localStorage.getItem("tj_gclid")||null,fbclid:localStorage.getItem("tj_fbclid")||null};return t.ga_client_id=o.getGAClientId(),t.ga_session_id=o.getGASessionId(),t.fbp=o.get("_fbp"),t.fbc=o.get("_fbc")||(t.fbclid?`fb.1.${Date.now()}.${t.fbclid}`:null),t}a();let i,c=0;function s(){t.track("vertical_scroll",{scroll_y:c,screen_size:`${window.innerWidth}x${window.innerHeight}`,session_id:t.session_id})}window.addEventListener("scroll",function(){c=window.scrollY,clearTimeout(i),i=setTimeout(s,3e3)}),t.track=function(e,o={}){o.url=window.location.href,o.referrer=document.referrer,o.session_id=t.session_id,o.site_id=t.site_id,o.screen_size=`${window.innerWidth}x${window.innerHeight}`,o.device=navigator.userAgent,o.timestamp=(new Date).toISOString(),t.dataLayer.push({event:e,data:o}),t.sending||(t.sending=setTimeout(()=>{let e=t.dataLayer.slice();t.dataLayer=[],navigator.sendBeacon?navigator.sendBeacon(`${n.workerUrl}?site_id=${t.site_id}`,JSON.stringify({events:e})):fetch(`${n.workerUrl}?site_id=${t.site_id}`,{method:"POST",body:JSON.stringify({events:e})}),t.sending=null},2e3))},t.track("page_view"),document.addEventListener("click",function(n){const e=n.target.closest("a, button");if(!e)return;s();let o={target:e.tagName.toLowerCase(),text:e.innerText?e.innerText.substring(0,50):"",class:e.className||"",id:e.id||"",href:e.href||""};"a"===e.tagName.toLowerCase()&&e.hostname!==window.location.hostname?(o.external=!0,t.track("click_outbound",o),navigator.sendBeacon(`${n.workerUrl}?site_id=${t.site_id}`,JSON.stringify({events:[{event:"click_outbound",data:o}]}))):t.track("click",o)}),document.addEventListener("submit",function(e){const o=e.target;if(!o||"form"!==o.tagName.toLowerCase())return;if("true"!==o.getAttribute("data-track"))return;let a=new FormData(o),c={},s={nome:null,email:null,tel:null,tag:null};for(let[t,n]of a.entries())if("string"!=typeof t||!t.toLowerCase().includes("senha")){c[t]=n;const e=t.toLowerCase();s.nome||!e.includes("nome")&&!e.includes("name")||(s.nome=n),s.email||!e.includes("mail")||(s.email=n),s.tel||!e.includes("tel")&&!e.includes("phone")&&!e.includes("cel")&&!e.includes("whats")||(s.tel=n)}const l=r();t.track("form_submit",{form_id:o.id||"",fields:c});const u={leads:[{site_id:t.site_id,session_id:t.session_id,tag:o.getAttribute("data-tag")||"Formulario Site",nome:s.nome||"Lead sem nome",tel:s.tel||"",email:s.email||"",url:window.location.href,referrer:document.referrer,user_agent:navigator.userAgent,ip:"",marketing:l,pergunta:JSON.stringify(c)}]};// console.log("TJ Hub: Enviando Lead...",u); // Comentado para produção
fetch(n.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).then(t=>t.json()).then(t=>{/*console.log("Sucesso",t)*/}).catch(t=>{/*console.error("Erro",t)*/})}),window.tjHub=t}();